generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model CodeReviewResult {
  id                  BigInt                @id @default(autoincrement())
  pr_number           Int?
  repo                String?               @db.VarChar(255)
  branch              String?               @db.VarChar(255)
  author              String?               @db.VarChar(255)
  security_result     Json?
  summary_result      Json?
  created_at          DateTime?             @default(now()) @map("created_at") @db.Timestamp(0)
  notification_outbox notification_outbox[]

  @@map("code_review_results")
}

model notification_outbox {
  id                  BigInt           @id @default(autoincrement())
  aggregate_type      String           @db.VarChar(64)
  aggregate_id        BigInt
  status              String           @default("READY") @db.VarChar(16)
  retry_count         Int              @default(0)
  last_error          String?          @db.Text
  created_at          DateTime?        @default(now()) @db.Timestamp(0)
  updated_at          DateTime?        @default(now()) @db.Timestamp(0)
  code_review_results CodeReviewResult @relation(fields: [aggregate_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_aggregate_id")

  @@unique([aggregate_type, aggregate_id], map: "uniq_agg")
  @@index([aggregate_id], map: "fk_aggregate_id")
  @@index([status], map: "idx_status")
}
